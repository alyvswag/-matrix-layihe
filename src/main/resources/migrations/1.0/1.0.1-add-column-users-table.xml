<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">


    <changeSet id="1.0.1-32-add-is-active-column-to-users" author="nuray_aghazade">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="users"/>
        </preConditions>

        <addColumn tableName="users">
            <column name="is_active" type="BOOLEAN" defaultValueBoolean="true">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="33-drop-parent-id-column-from-categories" author="nuray_aghazade">
        <!-- Əvvəlcə FK constraint-i silirik -->
        <dropForeignKeyConstraint
                baseTableName="categories"
                constraintName="fk_categories_parent"/>

        <!-- Sonra sütunu tamamilə silirik -->
        <dropColumn tableName="categories" columnName="parent_id"/>
    </changeSet>
    <changeSet id="34-drop-expires-at-column-from-user-coupons" author="nuray_aghazade">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="user_coupons" columnName="expires_at"/>
        </preConditions>

        <dropColumn tableName="user_coupons" columnName="expires_at"/>
    </changeSet>
    <changeSet id="35-drop-used-order-id-column" author="nuray_aghazade">
        <preConditions onFail="MARK_RAN">
            <or>
                <foreignKeyConstraintExists
                        foreignKeyName="fk_user_coupons_used_order"/>
                <columnExists
                        tableName="user_coupons"
                        columnName="used_order_id"/>
            </or>
        </preConditions>

        <dropForeignKeyConstraint
                baseTableName="user_coupons"
                constraintName="fk_user_coupons_used_order"/>

        <dropColumn
                tableName="user_coupons"
                columnName="used_order_id"/>
    </changeSet>
    <changeSet id="36-add-quantity-to-cart-items" author="nuray_aghazade">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="cart_items"/>
        </preConditions>

        <addColumn tableName="cart_items">
            <column name="quantity" type="BIGINT" defaultValueNumeric="1">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>





</databaseChangeLog>
